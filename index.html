<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM 碳足跡評估工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        .tab-content {
            transition: opacity 0.3s ease-in-out;
        }
        .tab-content.hidden {
            opacity: 0;
            display: none;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #1F2937;
            color: #fff;
            text-align: center;
            border-radius: 0.5rem;
            padding: 0.75rem;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            font-size: 0.875rem;
            box-shadow: 0 5px 15px -3px rgba(0, 0, 0, 0.2);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
            transform: translateY(-5px);
        }
        .info-icon {
            cursor: pointer;
            margin-left: 8px;
            color: #A0AEC0;
            transition: color 0.3s;
        }
        .info-icon:hover {
            color: #14B8A6;
        }
        .input-field:read-only, .input-field:disabled {
            background-color: #F1F5F9;
            color: #64748B;
        }
        .dark .input-field:read-only, .dark .input-field:disabled {
            background-color: #4B5563;
            color: #9CA3AF;
        }
        .results-container {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex justify-center min-h-screen p-4">

    <div class="w-full max-w-6xl bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden my-8">
        <header class="p-6 bg-gray-50 dark:bg-gray-700/50">
            <h1 class="text-2xl font-bold text-center text-gray-900 dark:text-white">LLM 碳足跡評估工具</h1>
            <p class="text-sm text-center text-gray-500 dark:text-gray-400 mt-1">整合 LLM 訓練、推論及硬體生命週期的碳排計算</p>
            <p class="text-xs text-center text-gray-400 dark:text-gray-500 mt-2">Developed By 黃子瑄</p>
        </header>

        <!-- 書籤式頁籤導覽列 -->
        <div class="border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-10">
            <nav class="-mb-px flex" aria-label="Tabs" id="tab-buttons">
                <button class="tab-button active-tab group w-1/3 inline-flex items-center justify-center py-4 px-1 border-b-2 font-medium text-sm text-indigo-600 dark:text-indigo-400 border-indigo-500" data-tab="tool1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-12h2v6h-2v-6zm0 8h2v2h-2v-2z"/>
                    </svg>
                    AI 晶片 LCA
                </button>
                <button class="tab-button inactive-tab group w-1/3 inline-flex items-center justify-center py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-500" data-tab="tool2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                    </svg>
                    LLM 訓練碳排
                </button>
                <button class="tab-button inactive-tab group w-1/3 inline-flex items-center justify-center py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-500" data-tab="tool3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    LLM 推論碳排
                </button>
            </nav>
        </div>

        <!-- 工具內容區域 -->
        <div class="p-6 md:p-8">
            <!-- 工具 1: AI 晶片 LCA 評估 -->
            <div id="tool1" class="tab-content">
                 <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                    <div class="p-2">
                        <h2 class="text-2xl font-semibold mb-6 border-b-2 border-gray-200 dark:border-gray-600 pb-4">參數設定</h2>
                        <div class="mb-6">
                            <label for="gpuChip" class="block text-gray-700 dark:text-gray-300 font-bold mb-2">選擇 AI 晶片模型</label>
                            <div class="relative">
                                <select id="gpuChip" class="lca-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 appearance-none bg-white dark:bg-gray-700">
                                    <option value="A100">NVIDIA A100</option>
                                    <option value="H100">NVIDIA H100</option>
                                    <option value="B200">NVIDIA B200</option>
                                    <option value="B300">NVIDIA B300</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15 9.707l-1.414-1.414L10 11.586l-3.586-3.586L5 9.707z"/></svg>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label for="lifespan" class="block text-gray-700 dark:text-gray-300 font-bold mb-2">預估使用年限 (年)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">AI 晶片在資料中心或伺服器環境中的典型運作壽命，通常為 5 年。</span></span></label>
                                <input type="number" id="lifespan" class="lca-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="5" min="1">
                            </div>
                            <div>
                                <label for="utilization" class="block text-gray-700 dark:text-gray-300 font-bold mb-2">每日運作時數 (小時)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">AI 晶片在一天中進行訓練或推論任務的平均時間，建議值為 24 小時。</span></span></label>
                                <input type="number" id="utilization" class="lca-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="24" min="0" max="24">
                            </div>
                        </div>
                        <div class="mb-6">
                            <label for="carbonIntensity" class="block text-gray-700 dark:text-gray-300 font-bold mb-2">電網碳強度 (kgCO₂e/kWh)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">每產生一度電所產生的碳排放量。台灣 2022 年平均值約為 0.416 kgCO₂e/kWh。</span></span></label>
                            <input type="number" id="carbonIntensity" class="lca-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="0.416" step="0.001">
                        </div>
                        <div class="text-center mt-8">
                            <button id="calculateLcaBtn" class="w-full bg-gradient-to-r from-blue-600 to-teal-500 text-white font-bold py-4 px-8 rounded-xl hover:from-blue-700 hover:to-teal-600 transition-all duration-300 text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1">開始計算</button>
                        </div>
                    </div>
                    <div id="lca-results-container" class="p-2 results-container">
                        <h2 class="text-2xl font-semibold mb-6 border-b-2 border-gray-200 dark:border-gray-600 pb-4">計算結果</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-emerald-50 dark:bg-emerald-900/50 p-4 rounded-xl flex flex-col items-center justify-center text-center transition hover:scale-105 border border-emerald-200 dark:border-emerald-800">
                                <span role="img" aria-label="cloud-with-emissions" class="text-4xl mb-2">💨</span>
                                <h4 class="font-medium text-emerald-800 dark:text-emerald-200 mb-2">總碳足跡<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">晶片在整個生命週期中產生的溫室氣體總排放量，包含製造與運作階段。</span></span></h4>
                                <p id="totalCo2" class="text-3xl font-bold text-emerald-900 dark:text-emerald-100">-- <span class="text-base font-normal">tCO₂eq</span></p>
                            </div>
                            <div class="bg-sky-50 dark:bg-sky-900/50 p-4 rounded-xl flex flex-col items-center justify-center text-center transition hover:scale-105 border border-sky-200 dark:border-sky-800">
                                <span role="img" aria-label="water-droplet" class="text-4xl mb-2">💧</span>
                                <h4 class="font-medium text-sky-800 dark:text-sky-200 mb-2">水資源消耗<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">晶片在其使用壽命內，於製造及運作過程中消耗的總水量。</span></span></h4>
                                <p id="waterConsumption" class="text-3xl font-bold text-sky-900 dark:text-sky-100">-- <span class="text-base font-normal">L</span></p>
                            </div>
                            <div class="bg-lime-50 dark:bg-lime-900/50 p-4 rounded-xl flex flex-col items-center justify-center text-center transition hover:scale-105 border border-lime-200 dark:border-lime-800">
                                <span role="img" aria-label="waste-bin" class="text-4xl mb-2">🗑️</span>
                                <h4 class="font-medium text-lime-800 dark:text-lime-200 mb-2">電子廢棄物<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">晶片在生命週期結束後產生的廢棄物重量，通常指產品本身的重量。</span></span></h4>
                                <p id="eWaste" class="text-3xl font-bold text-lime-900 dark:text-lime-100">-- <span class="text-base font-normal">kg</span></p>
                            </div>
                        </div>
                        <div class="border-t pt-6 mt-6 space-y-6">
                            <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-300 mb-3">碳排細項分析</h3>
                            <div class="grid grid-cols-2 gap-4 text-center">
                                <div class="bg-blue-100 dark:bg-blue-900/50 p-4 rounded-xl border border-blue-200 dark:border-blue-800 flex flex-col justify-center transition hover:scale-105">
                                    <h4 class="font-medium text-blue-800 dark:text-blue-200">營運碳排<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">晶片在運作期間，因電力消耗所產生的碳排。</span></span></h4>
                                    <p id="operationalCo2" class="text-2xl font-semibold text-blue-900 dark:text-blue-100">-- <span class="text-base font-normal">tCO₂eq</span></p>
                                </div>
                                <div class="bg-teal-100 dark:bg-teal-900/50 p-4 rounded-xl border border-teal-200 dark:border-teal-800 flex flex-col justify-center transition hover:scale-105">
                                    <h4 class="font-medium text-teal-800 dark:text-teal-200">隱含碳排<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">晶片在製造、運輸及棄置階段所產生的碳排。</span></span></h4>
                                    <p id="embodiedCo2" class="text-2xl font-semibold text-teal-900 dark:text-teal-100">-- <span class="text-base font-normal">tCO₂eq</span></p>
                                </div>
                            </div>
                            <div class="max-w-xs mx-auto mb-6"><canvas id="carbonChart"></canvas></div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-300 mb-3">日常換算</h3>
                                <div id="lca-equivalents" class="grid grid-cols-2 lg:grid-cols-4 gap-4"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 工具 2: LLM 訓練碳排計算器 -->
            <div id="tool2" class="tab-content hidden">
                 <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                    <div class="p-2">
                        <h2 class="text-2xl font-semibold mb-6 border-b-2 border-gray-200 dark:border-gray-600 pb-4">參數設定</h2>
                        <section>
                            <h3 class="text-xl font-semibold text-blue-600 dark:text-blue-400 mb-4">1. LLM 模型設定</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="modelPreset" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">模型預設</label>
                                    <select id="modelPreset" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 bg-white">
                                    </select>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="modelType" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">模型類型</label>
                                        <select id="modelType" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 bg-white">
                                            <option value="dense">Dense (密集模型)</option>
                                            <option value="MoE">MoE (專家混合模型)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="parametersB" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">總參數數量 (B)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">模型的總參數數量，單位為十億 (Billion)。</span></span></label>
                                        <input type="number" id="parametersB" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600">
                                    </div>
                                    <div id="baseModelParamsContainer" class="hidden">
                                        <label for="baseModelParamsB" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">基礎模型參數 (B)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">對於 MoE 模型，其對應的密集基礎模型參數數量。</span></span></label>
                                        <input type="number" id="baseModelParamsB" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600">
                                    </div>
                                    <div>
                                        <label for="tokensB" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">處理 Token 數量 (B)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">模型在訓練或推論過程中處理的 Token 總數，單位為十億 (Billion)。</span></span></label>
                                        <input type="number" id="tokensB" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600">
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section class="mt-6">
                            <h3 class="text-xl font-semibold text-sky-600 dark:text-sky-400 mb-4">2. 硬體與資料中心設定</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="deviceType" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">運算裝置</label>
                                    <select id="deviceType" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 bg-white">
                                        <option value="V100">NVIDIA V100</option>
                                        <option value="A100">NVIDIA A100</option>
                                        <option value="H100">NVIDIA H100</option>
                                        <option value="TPUv3">Google TPUv3</option>
                                        <option value="TPUv4">Google TPUv4</option>
                                        <option value="custom">自訂</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="deviceNum" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">裝置數量</label>
                                    <input type="number" id="deviceNum" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="10000">
                                </div>
                                <div>
                                    <label for="systemPower" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">平均系統功耗 (W/裝置)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">每台運算裝置（包含主機、記憶體等）的平均總功耗。</span></span></label>
                                    <input type="number" id="systemPower" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="330">
                                </div>
                                <div>
                                    <label for="hardwareEfficiency" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">硬體效率 (%)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">實際運算吞吐量相對於理論峰值吞吐量的百分比。</span></span></label>
                                    <input type="number" id="hardwareEfficiency" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="19.7" step="0.1">
                                </div>
                                <div>
                                    <label for="pue" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">PUE<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">電力使用效率 (Power Usage Effectiveness)，資料中心總耗能與 IT 設備耗能的比值，越接近 1 效率越高。</span></span></label>
                                    <input type="number" id="pue" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="1.1" step="0.01">
                                </div>
                                <div>
                                    <label for="trainingCo2eqkwh" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">碳強度 (kgCO₂eq/kWh)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">資料中心每消耗一度電（kWh）所產生的二氧化碳當量(公斤)。預設值為美國平均。</span></span></label>
                                    <input type="number" id="trainingCo2eqkwh" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="0.429" step="0.001">
                                </div>
                                <div class="md:col-span-2">
                                     <label for="gpuCostPerHour" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">GPU 單位成本 ($/小時)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">單一 GPU 每小時的運算成本。預設值參考 Microsoft Azure V100 隨用隨付價格。</span></span></label>
                                    <input type="number" id="gpuCostPerHour" class="training-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="3.09" step="0.01">
                               </div>
                            </div>
                        </section>
                        <div class="text-center mt-8">
                            <button id="calculateTrainingBtn" class="w-full bg-gradient-to-r from-blue-600 to-teal-500 text-white font-bold py-4 px-8 rounded-xl hover:from-blue-700 hover:to-teal-600 transition-all duration-300 text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1">開始計算</button>
                        </div>
                    </div>
                    <div id="training-results-container" class="p-2 results-container">
                        <h2 class="text-2xl font-semibold mb-6 border-b-2 border-gray-200 dark:border-gray-600 pb-4">計算結果</h2>
                        <div class="space-y-6">
                            <div id="key-metrics" class="grid grid-cols-2 gap-4 text-center">
                                <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border dark:border-gray-600">
                                    <h4 class="text-md font-medium text-gray-800 dark:text-gray-300">訓練碳排<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">模型訓練期間，因電力消耗所產生的碳排。</span></span></h4>
                                    <p id="operationalCo2Display" class="text-2xl font-bold text-blue-700 dark:text-blue-400 mt-2">-- <span class="text-base font-normal">tCO₂eq</span></p>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border dark:border-gray-600">
                                    <h4 class="text-md font-medium text-gray-800 dark:text-gray-300">總消耗電量<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">模型訓練期間，資料中心總共消耗的電量。</span></span></h4>
                                    <p id="totalEnergyMWhDisplay" class="text-2xl font-bold text-sky-700 dark:text-sky-400 mt-2">-- <span class="text-base font-normal">MWh</span></p>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border dark:border-gray-600">
                                    <h4 class="text-md font-medium text-gray-800 dark:text-gray-300">預估訓練時間<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">模型完成訓練所需的總時間。</span></span></h4>
                                    <p id="trainingDurationDisplay" class="text-2xl font-bold text-indigo-700 dark:text-indigo-400 mt-2">-- 天</p>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border dark:border-gray-600">
                                    <h4 class="text-md font-medium text-gray-800 dark:text-gray-300">預估訓練成本<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">模型訓練期間所需的硬體租用成本 (USD)。</span></span></h4>
                                    <p id="trainingCostDisplay" class="text-2xl font-bold text-purple-700 dark:text-purple-400 mt-2">--</p>
                                </div>
                            </div>
                            <div class="border-t dark:border-gray-600 pt-6 mt-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-300 mb-3">日常換算</h3>
                                    <div id="training-equivalents" class="grid grid-cols-2 gap-4">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 工具 3: LLM 推論碳排計算器 -->
            <div id="tool3" class="tab-content hidden">
                 <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                    <div class="p-2">
                        <h2 class="text-2xl font-semibold mb-6 border-b-2 border-gray-200 dark:border-gray-600 pb-4">參數設定</h2>
                        <section>
                            <h3 class="text-xl font-semibold text-blue-700 dark:text-blue-400 mb-4">1. LLM 模型設定</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="inf-modelPreset" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">選擇預設模型</label>
                                    <select id="inf-modelPreset" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 bg-white">
                                        <option value="GPT3" selected>GPT-3 (175B)</option>
                                        <option value="GPT4">GPT-4 (1.8T)</option>
                                        <option value="custom">自訂</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="inf-tokensT" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">處理 Token 數量<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">根據常見任務類型預設的 Token 數量。</span></span></label>
                                    <select id="inf-tokensT" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 bg-white">
                                        <option value="5e-9">問答 (RAG) (約 5k tokens)</option>
                                        <option value="5e-8">翻譯 (約 50k tokens)</option>
                                        <option value="2e-8">程式碼生成/Debug (約 20k tokens)</option>
                                        <option value="1.5e-7">文件摘要 (約 150k tokens)</option>
                                    </select>
                                </div>
                                <div id="inf-customModelSection" class="pt-2 hidden space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label for="inf-modelType" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">模型類型</label>
                                            <select id="inf-modelType" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 bg-white">
                                                <option value="dense">Dense (密集模型)</option>
                                                <option value="MoE">MoE (專家混合模型)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="inf-parametersB" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">總參數數量 (B)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">模型的總參數數量，單位為十億 (Billion)。</span></span></label>
                                            <input type="number" id="inf-parametersB" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="175" min="0">
                                        </div>
                                        <div id="inf-baseModelParamsContainer" class="hidden">
                                            <label for="inf-baseModelParamsB" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">基礎模型參數 (B)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">對於 MoE 模型，其對應的密集基礎模型參數數量。</span></span></label>
                                            <input type="number" id="inf-baseModelParamsB" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="2.3" min="0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section class="mt-6">
                            <h3 class="text-xl font-semibold text-teal-700 dark:text-teal-400 mb-4">2. 硬體與資料中心設定</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="inf-deviceType" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">運算裝置</label>
                                    <select id="inf-deviceType" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600 bg-white">
                                        <option value="V100">NVIDIA V100</option>
                                        <option value="H100">NVIDIA H100</option>
                                        <option value="A100">NVIDIA A100</option>
                                        <option value="TPUv3">Google TPUv3</option>
                                        <option value="TPUv4">Google TPUv4</option>
                                        <option value="custom">自訂</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="inf-deviceNum" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">裝置數量</label>
                                    <input type="number" id="inf-deviceNum" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="8" min="1">
                                </div>
                                <div>
                                    <label for="inf-systemPower" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">平均系統功耗 (W/裝置)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">每台運算裝置（包含主機、記憶體等）的平均總功耗。</span></span></label>
                                    <input type="number" id="inf-systemPower" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="550" min="0">
                                </div>
                                <div>
                                    <label for="inf-hardwareEfficiency" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">硬體效率 (%)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">實際運算吞吐量相對於理論峰值吞吐量的百分比。</span></span></label>
                                    <input type="number" id="inf-hardwareEfficiency" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="19.7" step="0.1" min="0" max="100">
                                </div>
                                <div>
                                    <label for="inf-pue" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">PUE<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">電力使用效率 (Power Usage Effectiveness)，資料中心總耗能與 IT 設備耗能的比值，越接近 1 效率越高。</span></span></label>
                                    <input type="number" id="inf-pue" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="1.1" step="0.01" min="1">
                                </div>
                                <div>
                                    <label for="inf-co2eqkwh" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">碳強度 (gCO₂eq/kWh)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">資料中心每消耗一度電（kWh）所產生的二氧化碳當量。預設值為美國平均。</span></span></label>
                                    <input type="number" id="inf-co2eqkwh" class="inf-input input-field w-full p-3 border border-gray-300 rounded-lg dark:bg-gray-700 dark:border-gray-600" value="429" min="0">
                                </div>
                            </div>
                        </section>
                         <div class="text-center mt-8">
                            <button id="calculateInferenceBtn" class="w-full bg-gradient-to-r from-blue-600 to-teal-500 text-white font-bold py-4 px-8 rounded-xl hover:from-blue-700 hover:to-teal-600 transition-all duration-300 text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1">開始計算</button>
                        </div>
                    </div>
                    <div id="inf-results-container" class="p-2 results-container">
                        <h2 class="text-2xl font-semibold mb-6 border-b-2 border-gray-200 dark:border-gray-600 pb-4">計算結果</h2>
                        <div class="space-y-6">
                            <div class="text-center">
                                <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-300">總碳足跡 (gCO₂eq)<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">模型在推論任務中，因電力消耗所產生的總碳排。</span></span></h3>
                                <p id="inf-totalCo2" class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-teal-500 my-2">--</p>
                            </div>
                            <div class="border-t pt-6 mt-6 space-y-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-300 mb-3">詳細資訊</h3>
                                    <div id="inf-details" class="grid grid-cols-2 gap-4">
                                        <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border flex flex-col justify-center text-center">
                                            <h4 class="text-md font-medium text-gray-700 dark:text-gray-300 mb-2">預估推論時間<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">模型完成推論所需的總時間。</span></span></h4>
                                            <p class="text-2xl font-bold text-gray-800 dark:text-gray-200" id="inf-timeDisplay">--</p>
                                        </div>
                                        <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border flex flex-col justify-center text-center">
                                            <h4 class="text-md font-medium text-gray-700 dark:text-gray-300 mb-2">總消耗電量<span class="tooltip"><svg class="info-icon inline w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><span class="tooltiptext">模型推論期間，資料中心總共消耗的電量。</span></span></h4>
                                            <p class="text-2xl font-bold text-gray-800 dark:text-gray-200" id="inf-energyDisplay">--</p>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-600 dark:text-gray-300 mb-3">日常換算</h3>
                                    <div id="inf-equivalents" class="grid grid-cols-2 gap-4">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- 頁籤切換邏輯 ---
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active-tab', 'text-indigo-600', 'dark:text-indigo-400', 'border-indigo-500');
                        btn.classList.add('inactive-tab', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-500');
                    });
                    button.classList.add('active-tab', 'text-indigo-600', 'dark:text-indigo-400', 'border-indigo-500');
                    button.classList.remove('inactive-tab', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-500');
                    tabContents.forEach(content => {
                        content.id === targetTab ? content.classList.remove('hidden') : content.classList.add('hidden');
                    });
                });
            });
            
            // --- 通用函式 ---
            function animateValue(element, start, end, duration, unit = '', isCurrency = false, isDuration = false) {
                 if (!element) return;
                let startTimestamp = null;
                const step = timestamp => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    const currentValue = progress * (end - start) + start;
                    if (isCurrency) {
                        element.textContent = `$${Math.floor(currentValue).toLocaleString('en-US')}`;
                    } else if (isDuration) {
                        element.textContent = currentValue < 365 ? `${currentValue.toFixed(2)} 天` : `${(currentValue / 365).toFixed(2)} 年`;
                    } else {
                        element.innerHTML = `${currentValue.toFixed(2)} <span class="text-base font-normal">${unit}</span>`;
                    }
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            }

            // --- 工具 1: AI 晶片 LCA 評估邏輯 ---
            const lcaResultsContainerEl = document.getElementById('lca-results-container');
            const gpuData = {
                "A100": { tdp_watt: 400, cradle_to_gate_kg: 120, water_L_per_year: [1000, 6000], e_waste_kg: 2.5 },
                "H100": { tdp_watt: 700, cradle_to_gate_kg: 164, water_L_per_year: [2000, 8000], e_waste_kg: 3 },
                "B200": { tdp_watt: 1100, cradle_to_gate_kg: 284, water_L_per_year: [3500, 10000], e_waste_kg: 2.5 },
                "B300": { tdp_watt: 1300, cradle_to_gate_kg: 300, water_L_per_year: [3500, 15000], e_waste_kg: 3.5 }
            };
            const lcaDailyEquivalents = {
                flight: { name: '趟台北-東京航班', value: 0.4, icon: `✈️`, tooltip: '一趟台北飛往東京的來回航班所產生的碳排。' },
                car: { name: '輛汽車年排碳', value: 1.9, icon: `🚗`, tooltip: '一輛普通家用汽車行駛一年所產生的平均碳排。' },
                tree: { name: '棵樹年吸碳量', value: 0.012, icon: `🌳`, tooltip: '一棵樹一年所能吸收的二氧化碳總量。' },
                bento: { name: '個排骨便當', value: 0.0015, icon: `🍱`, tooltip: '一個排骨便當從生產到消費所產生的碳排。' },
            };
            let carbonChartInstance = null;
            
            function updateChart(operational, embodied) {
                const ctx = document.getElementById('carbonChart').getContext('2d');
                if (carbonChartInstance) carbonChartInstance.destroy();
                carbonChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['營運碳排', '隱含碳排'],
                        datasets: [{ data: [operational, embodied], backgroundColor: ['#3B82F6', '#14B8A6'], borderColor: document.body.classList.contains('dark') ? '#1f2937' : '#FFFFFF', borderWidth: 4 }]
                    },
                    options: {
                        responsive: true, cutout: '70%',
                        plugins: {
                            legend: { position: 'bottom', labels: { color: document.body.classList.contains('dark') ? '#D1D5DB' : '#4B5563' } },
                            title: { display: true, text: '碳足跡組成 (tCO₂eq)', color: document.body.classList.contains('dark') ? '#F9FAFB' : '#1F2937', font: { size: 16 } }
                        }
                    },
                });
            }

            function runLcaCalculation() {
                const gpuChip = document.getElementById('gpuChip').value;
                const lifespan = parseFloat(document.getElementById('lifespan').value);
                const utilization = parseFloat(document.getElementById('utilization').value);
                const carbonIntensity = parseFloat(document.getElementById('carbonIntensity').value);

                if (isNaN(lifespan) || isNaN(utilization) || isNaN(carbonIntensity) || lifespan <= 0 || utilization < 0 || utilization > 24 || carbonIntensity <= 0) {
                    alert("請輸入有效的數值。");
                    return;
                }

                const data = gpuData[gpuChip];
                const totalHours = lifespan * 365 * utilization;
                const totalKWH = (data.tdp_watt * totalHours) / 1000;
                const operationalCo2 = (totalKWH * carbonIntensity) / 1000;
                const embodiedCo2 = data.cradle_to_gate_kg / 1000;
                const totalCo2 = operationalCo2 + embodiedCo2;
                const avgWater = (data.water_L_per_year[0] + data.water_L_per_year[1]) / 2;
                const totalWater = avgWater * lifespan;
                const eWaste = data.e_waste_kg;

                document.getElementById('totalCo2').innerHTML = `${totalCo2.toFixed(2)} <span class="text-base font-normal">tCO₂eq</span>`;
                document.getElementById('operationalCo2').innerHTML = `${operationalCo2.toFixed(2)} <span class="text-base font-normal">tCO₂eq</span>`;
                document.getElementById('embodiedCo2').innerHTML = `${embodiedCo2.toFixed(2)} <span class="text-base font-normal">tCO₂eq</span>`;
                document.getElementById('waterConsumption').innerHTML = `${totalWater.toFixed(0).toLocaleString('zh-TW')} <span class="text-base font-normal">L</span>`;
                document.getElementById('eWaste').innerHTML = `${eWaste.toFixed(2)} <span class="text-base font-normal">kg</span>`;
                
                updateChart(operationalCo2, embodiedCo2);

                const equivalentsContainer = document.getElementById('lca-equivalents');
                equivalentsContainer.innerHTML = '';
                for (const key in lcaDailyEquivalents) {
                    const item = lcaDailyEquivalents[key];
                    const equivalentAmount = totalCo2 / item.value;
                    equivalentsContainer.innerHTML += `<div class="bg-white dark:bg-gray-700 p-3 rounded-lg text-center transition duration-300 ease-in-out shadow-sm hover:shadow-lg transform hover:-translate-y-1 border dark:border-gray-600"><div class="tooltip"><span class="text-3xl">${item.icon}</span><span class="tooltiptext">${item.tooltip} 碳排：${item.value.toFixed(4).replace(/0+$/, '').replace(/\.$/, '')} tCO₂eq</span></div><p class="text-xl font-bold text-gray-800 dark:text-gray-200 mt-2">${Math.round(equivalentAmount).toLocaleString('zh-TW')}</p><p class="text-xs text-gray-600 dark:text-gray-400 mt-1">${item.name}</p></div>`;
                }
            }
            
            document.getElementById('calculateLcaBtn').addEventListener('click', runLcaCalculation);

            // --- 工具 2: LLM 訓練碳排計算器邏輯 ---
            const modelPresetSelect = document.getElementById('modelPreset');
            const modelTypeSelect = document.getElementById('modelType');
            const baseModelParamsContainer = document.getElementById('baseModelParamsContainer');
            const deviceTypeSelect = document.getElementById('deviceType');
            
            const modelPresets = {
                'GPT3': { name: 'GPT-3 (175B)', type: 'dense', params: 175, baseParams: '', tokens: 300, deviceType: 'V100', deviceNum: 10000 },
                'GPT4': { name: 'GPT-4 (1.8T)', type: 'MoE', params: 1800, baseParams: 111, tokens: 13000, deviceType: 'A100', deviceNum: 25000 },
                'custom': { name: '自訂模型' },
            };
            const hardwarePresets = {
                'V100': { peakTFLOPs: 125, systemPower: 330 }, 'A100': { peakTFLOPs: 312, systemPower: 550 },
                'H100': { peakTFLOPs: 1979, systemPower: 800 }, 'TPUv3': { peakTFLOPs: 123, systemPower: 288 },
                'TPUv4': { peakTFLOPs: 275, systemPower: 250 }, 'custom': { peakTFLOPs: 125, systemPower: 330 }
            };
            const trainingDailyEquivalents = {
                flight: { name: '趟台北-東京航班', value: 0.4, icon: `✈️`, tooltip: '一趟台北飛往東京的來回航班所產生的碳排。' },
                car: { name: '輛汽車年排碳', value: 1.9, icon: `🚗`, tooltip: '一輛普通家用汽車行駛一年所產生的平均碳排。' },
                tree: { name: '棵樹年吸碳量', value: 0.012, icon: `🌳`, tooltip: '一棵樹一年所能吸收的二氧化碳總量。' },
                bento: { name: '個排骨便當', value: 0.0015, icon: `🍱`, tooltip: '一個排骨便當從生產到消費所產生的碳排。' },
            };

            for (const key in modelPresets) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = modelPresets[key].name;
                modelPresetSelect.appendChild(option);
            }

            function updateTrainingForm() {
                const selectedModelKey = modelPresetSelect.value;
                const preset = modelPresets[selectedModelKey];
                const isCustom = selectedModelKey === 'custom';

                if (!isCustom) {
                    modelTypeSelect.value = preset.type;
                    document.getElementById('parametersB').value = preset.params;
                    document.getElementById('tokensB').value = preset.tokens;
                    deviceTypeSelect.value = preset.deviceType;
                    document.getElementById('deviceNum').value = preset.deviceNum;
                    document.getElementById('systemPower').value = (hardwarePresets[preset.deviceType] || hardwarePresets['custom']).systemPower;
                    if (preset.type === 'MoE') {
                        document.getElementById('baseModelParamsB').value = preset.baseParams;
                    } else {
                        document.getElementById('baseModelParamsB').value = '';
                    }
                }
                
                document.getElementById('modelType').disabled = !isCustom;
                document.getElementById('parametersB').disabled = !isCustom;
                document.getElementById('baseModelParamsB').disabled = !isCustom;
                document.getElementById('tokensB').disabled = !isCustom;
                
                baseModelParamsContainer.classList.toggle('hidden', modelTypeSelect.value !== 'MoE');
            }

            modelPresetSelect.addEventListener('change', updateTrainingForm);
            
            deviceTypeSelect.addEventListener('change', () => {
                 document.getElementById('systemPower').value = (hardwarePresets[deviceTypeSelect.value] || hardwarePresets['custom']).systemPower;
            });
            
            function runTrainingCalculation() {
                const inputs = {
                    modelType: modelTypeSelect.value,
                    parametersB: parseFloat(document.getElementById('parametersB').value),
                    baseModelParamsB: parseFloat(document.getElementById('baseModelParamsB').value),
                    tokensB: parseFloat(document.getElementById('tokensB').value),
                    deviceType: deviceTypeSelect.value,
                    deviceNum: parseInt(document.getElementById('deviceNum').value),
                    systemPower: parseFloat(document.getElementById('systemPower').value),
                    hardwareEfficiency: parseFloat(document.getElementById('hardwareEfficiency').value),
                    pue: parseFloat(document.getElementById('pue').value),
                    co2eqkwh: parseFloat(document.getElementById('trainingCo2eqkwh').value),
                    gpuCostPerHour: parseFloat(document.getElementById('gpuCostPerHour').value),
                };

                let isValid = true;
                for (const key in inputs) {
                    if (inputs.modelType === 'dense' && key === 'baseModelParamsB') continue;
                    if (['modelType', 'deviceType'].includes(key)) continue;
                    if (isNaN(inputs[key])) { isValid = false; break; }
                    if (inputs[key] <= 0 && key !== 'baseModelParamsB') { isValid = false; break; }
                }
                if (inputs.modelType === 'MoE' && (isNaN(inputs.baseModelParamsB) || inputs.baseModelParamsB <= 0)) {
                    isValid = false;
                }

                if (!isValid) {
                    alert("請輸入有效的數值。");
                    return;
                }

                const activeParamsB = inputs.modelType === 'MoE' ? inputs.baseModelParamsB : inputs.parametersB;
                const totalFLOPs = 6 * activeParamsB * 1e9 * inputs.tokensB * 1e9;
                const TFLOPsPerSecond = hardwarePresets[inputs.deviceType].peakTFLOPs * (inputs.hardwareEfficiency / 100);
                const trainingSeconds = totalFLOPs / (inputs.deviceNum * TFLOPsPerSecond * 1e12);
                const trainingDays = trainingSeconds / 86400;
                const totalPowerKW = (inputs.systemPower * inputs.deviceNum) / 1000;
                const totalEnergyKWh = totalPowerKW * (trainingDays * 24) * inputs.pue;
                
                const results = {
                    operationalCo2: (totalEnergyKWh * inputs.co2eqkwh) / 1000,
                    trainingDays: trainingDays,
                    totalEnergyMWh: totalEnergyKWh / 1000,
                    trainingCost: trainingDays * 24 * inputs.deviceNum * inputs.gpuCostPerHour,
                };
                
                animateValue(document.getElementById('operationalCo2Display'), 0, results.operationalCo2, 500, 'tCO₂eq');
                animateValue(document.getElementById('totalEnergyMWhDisplay'), 0, results.totalEnergyMWh, 500, 'MWh');
                animateValue(document.getElementById('trainingCostDisplay'), 0, results.trainingCost, 500, '', true);
                animateValue(document.getElementById('trainingDurationDisplay'), 0, results.trainingDays, 500, '', false, true);
                
                const equivalentsContainer = document.getElementById('training-equivalents');
                equivalentsContainer.innerHTML = '';
                for (const key in trainingDailyEquivalents) {
                    const item = trainingDailyEquivalents[key];
                    const equivalentAmount = results.operationalCo2 / item.value;
                    equivalentsContainer.innerHTML += `<div class="bg-white dark:bg-gray-700 p-3 rounded-lg text-center transition duration-300 ease-in-out shadow-sm hover:shadow-lg transform hover:-translate-y-1 border dark:border-gray-600"><div class="tooltip"><span class="text-3xl">${item.icon}</span><span class="tooltiptext">${item.tooltip} 碳排：${item.value.toFixed(4).replace(/0+$/, '').replace(/\.$/, '')} tCO₂eq</span></div><p class="text-xl font-bold text-gray-800 dark:text-gray-200 mt-2">${Math.round(equivalentAmount).toLocaleString('zh-TW')}</p><p class="text-xs text-gray-600 dark:text-gray-400 mt-1">${item.name}</p></div>`;
                }
            }
            
            document.getElementById('calculateTrainingBtn').addEventListener('click', runTrainingCalculation);


            // --- 工具 3: LLM 推論碳排計算器邏輯 ---
            const infModelPresetSelect = document.getElementById('inf-modelPreset');
            const infCustomModelSection = document.getElementById('inf-customModelSection');
            const infModelTypeSelect = document.getElementById('inf-modelType');
            const infBaseModelParamsContainer = document.getElementById('inf-baseModelParamsContainer');
            const infDeviceTypeSelect = document.getElementById('inf-deviceType');
            
            const infModelPresets = {
                'GPT3': { parametersB: 175, type: 'dense', baseModelParamsB: null, deviceType: 'A100', deviceNum: 8, systemPower: 550 },
                'GPT4': { parametersB: 1800, type: 'MoE', baseModelParamsB: 200, deviceType: 'A100', deviceNum: 16, systemPower: 550 },
                'custom': { parametersB: 175, type: 'dense', baseModelParamsB: null, deviceType: 'V100', deviceNum: 1, systemPower: 330 }
            };
            const infHardwarePresets = {
                'V100': { peakTFLOPs: 125, systemPower: 330 }, 'H100': { peakTFLOPs: 1979, systemPower: 800 },
                'A100': { peakTFLOPs: 312, systemPower: 550 }, 'TPUv3': { peakTFLOPs: 123, systemPower: 288 },
                'TPUv4': { peakTFLOPs: 275, systemPower: 250 }, 'custom': { peakTFLOPs: 125, systemPower: 330 }
            };
            const infDailyEquivalents_g = {
                'sms': { name: '個簡訊', value: 0.014, icon: `💬`, tooltip: '一則簡訊的平均碳排。' },
                'google_search': { name: '次 Google 搜尋', value: 0.2, icon: `🔍`, tooltip: '一次 Google 搜尋的平均碳排。' },
                'youtube_stream': { name: '小時 YouTube 串流', value: 10, icon: `▶️`, tooltip: '觀看一小時 YouTube 影片的平均碳排。' },
                'video_conference': { name: '小時線上會議', value: 12, icon: `💻`, tooltip: '一小時線上視訊會議的平均碳排。' },
            };

            function updateInferenceForm() {
                const presetKey = infModelPresetSelect.value;
                const isCustom = presetKey === 'custom';
                const model = infModelPresets[presetKey];

                document.getElementById('inf-parametersB').value = model.parametersB;
                infModelTypeSelect.value = model.type;
                if (model.type === 'MoE') {
                    document.getElementById('inf-baseModelParamsB').value = model.baseModelParamsB;
                }
                infDeviceTypeSelect.value = model.deviceType;
                document.getElementById('inf-deviceNum').value = model.deviceNum;
                document.getElementById('inf-systemPower').value = model.systemPower;
                
                infCustomModelSection.classList.toggle('hidden', !isCustom);
                document.getElementById('inf-modelType').disabled = !isCustom;
                document.getElementById('inf-parametersB').disabled = !isCustom;
                document.getElementById('inf-baseModelParamsB').disabled = !isCustom;
                
                infBaseModelParamsContainer.classList.toggle('hidden', infModelTypeSelect.value !== 'MoE');
            }

            infModelPresetSelect.addEventListener('change', updateInferenceForm);
            
            infDeviceTypeSelect.addEventListener('change', () => {
                if (infDeviceTypeSelect.value !== 'custom') {
                    document.getElementById('inf-systemPower').value = infHardwarePresets[infDeviceTypeSelect.value].systemPower;
                }
            });
            
            function runInferenceCalculation() {
                const inputs = {
                    modelType: infModelTypeSelect.value,
                    parametersB: parseFloat(document.getElementById('inf-parametersB').value),
                    baseModelParamsB: parseFloat(document.getElementById('inf-baseModelParamsB').value),
                    tokensT: parseFloat(document.getElementById('inf-tokensT').value),
                    deviceType: infDeviceTypeSelect.value,
                    deviceNum: parseInt(document.getElementById('inf-deviceNum').value),
                    systemPower: parseFloat(document.getElementById('inf-systemPower').value),
                    hardwareEfficiency: parseFloat(document.getElementById('inf-hardwareEfficiency').value),
                    pue: parseFloat(document.getElementById('inf-pue').value),
                    co2eqkwh: parseFloat(document.getElementById('inf-co2eqkwh').value),
                };

                let isValid = true;
                for (const key in inputs) {
                    if (key === 'baseModelParamsB' && inputs.modelType !== 'MoE') continue;
                    if (['modelType', 'deviceType'].includes(key)) continue;
                    if (isNaN(inputs[key])) { isValid = false; break; }
                    if (inputs[key] < 0) { isValid = false; break; }
                }
                 if (inputs.pue < 1) { isValid = false; }
                 if (inputs.deviceNum < 1) { isValid = false; }
                
                if(!isValid) {
                    alert("請輸入有效的數值。");
                    return;
                }

                const activeParamsB = inputs.modelType === 'MoE' ? inputs.baseModelParamsB : inputs.parametersB;
                const totalZettaFLOPs = 2 * activeParamsB * inputs.tokensT;
                const totalFLOPs = totalZettaFLOPs * 1e21;
                const TFLOPsPerSecond = infHardwarePresets[inputs.deviceType].peakTFLOPs * (inputs.hardwareEfficiency / 100);
                const inferenceSeconds = totalFLOPs / (inputs.deviceNum * TFLOPsPerSecond * 1e12);
                const totalPowerKW = (inputs.systemPower * inputs.deviceNum) / 1000;
                const totalEnergyKWh = totalPowerKW * (inferenceSeconds / 3600) * inputs.pue;
                const results = { totalCo2_g: totalEnergyKWh * inputs.co2eqkwh, totalEnergyKWh, totalTimeSeconds: inferenceSeconds };
                
                document.getElementById('inf-totalCo2').textContent = results.totalCo2_g.toFixed(4);
                
                const { totalTimeSeconds } = results;
                let timeString;
                if (totalTimeSeconds < 1) timeString = `${(totalTimeSeconds * 1000).toFixed(2)} 毫秒`;
                else if (totalTimeSeconds < 60) timeString = `${totalTimeSeconds.toFixed(2)} 秒`;
                else if (totalTimeSeconds < 3600) timeString = `${(totalTimeSeconds / 60).toFixed(2)} 分鐘`;
                else timeString = `${(totalTimeSeconds / 3600).toFixed(2)} 小時`;
                document.getElementById('inf-timeDisplay').textContent = timeString;
                
                document.getElementById('inf-energyDisplay').textContent = `${(results.totalEnergyKWh * 1000).toFixed(2)} Wh`;
                
                const equivalentsContainer = document.getElementById('inf-equivalents');
                equivalentsContainer.innerHTML = '';
                for (const key in infDailyEquivalents_g) {
                    const item = infDailyEquivalents_g[key];
                    const equivalentAmount = results.totalCo2_g / item.value;
                    const formattedAmount = equivalentAmount < 1 && equivalentAmount > 0 ? equivalentAmount.toFixed(4) : Math.round(equivalentAmount).toLocaleString('zh-TW');
                    equivalentsContainer.innerHTML += `<div class="bg-white dark:bg-gray-700 p-3 rounded-lg text-center transition duration-300 ease-in-out shadow-sm hover:shadow-lg transform hover:-translate-y-1 border dark:border-gray-600"><div class="tooltip"><span class="text-3xl">${item.icon}</span><span class="tooltiptext">${item.tooltip} 碳排：${item.value.toFixed(4).replace(/0+$/, '').replace(/\.$/, '')} gCO₂eq</span></div><p class="text-xl font-bold text-gray-800 dark:text-gray-200 mt-2">${formattedAmount}</p><p class="text-xs text-gray-600 dark:text-gray-400 mt-1">${item.name}</p></div>`;
                }
            }

            document.getElementById('calculateInferenceBtn').addEventListener('click', runInferenceCalculation);
            
            // --- Initial Form Setup ---
            updateTrainingForm();
            updateInferenceForm();
            // Clear results on load to wait for button press
            document.querySelectorAll('.results-container').forEach(container => {
                container.style.opacity = '1';
            });
        });
    </script>
</body>
</html>

